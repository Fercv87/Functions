import numpy as np
import pandas as pd

def random_sampling_imputation2(df, columns, seed=0):
    """
    Imputes missing values in specified columns of a DataFrame using Random Sampling Imputation,
    attempting to preserve key statistical moments for the imputed values.
    Only the NaN values in the specified columns will be imputed.

    Parameters:
        df (pd.DataFrame): The input DataFrame.
        columns (list): Column names for imputation.
        seed (int): Seed for random number generator for reproducibility.

    Returns:
        pd.DataFrame: DataFrame with missing values imputed.
    """
    np.random.seed(seed)
    imputed_df = df.copy()

    for col in columns:
        # Calculate original statistics for non-missing values
        original_values = imputed_df[col].dropna()
        original_mean = original_values.mean()
        original_std = original_values.std()

        # Perform Random Sampling Imputation only on missing values
        missing_mask = imputed_df[col].isna()
        num_missing = missing_mask.sum()

        if num_missing > 0:
            random_samples = np.random.choice(original_values, size=num_missing)
            imputed_df.loc[missing_mask, col] = random_samples

            # Calculate new statistics after imputation
            new_mean = imputed_df[col].mean()
            new_std = imputed_df[col].std()

            # Adjust imputed values if necessary to match original mean and std
            if not np.isclose(new_mean, original_mean) or not np.isclose(new_std, original_std):
                # Adjust only the imputed values
                adjustment_factor = original_std / new_std
                adjusted_values = (imputed_df.loc[missing_mask, col] - new_mean) * adjustment_factor + original_mean
                imputed_df.loc[missing_mask, col] = adjusted_values

    return imputed_df

# List of columns to impute
columns_to_impute = [
    'Número_Robos_6',
    'Número_Robos_Inmuebles_7',
    'Número_Robos_Domicilio_7',
    'Número_Total_Infracciónes_Penales'
]

# Apply the function to your DataFrame
renta_extended3 = random_sampling_imputation2(renta_extended, columns_to_impute)
Glimpse(renta_extended3)
